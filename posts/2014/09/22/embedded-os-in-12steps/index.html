<!doctype html>
<html lang="jp">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>『12ステップで作る組込みOS自作入門』を読んで〜モバイルアプリエンジニアの生存戦略〜だからといって、このままでいいはずがない。</title>

    <link rel="stylesheet" href="http://yuseinishiyama.com/theme/css/main.css">
    <link rel="stylesheet" href="http://yuseinishiyama.com/theme/css/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <div><img src="" class="grv-img"/></div>
        <div class="title"><a href="http://yuseinishiyama.com/">だからといって、このままでいいはずがない。 </a></div>
        <div class="sub-title"></div>

<p>
    <div class="view"><a href="http://yuseinishiyama.com/pages/about-me.html">About Me</a></div>
  <div class="view"><a href="http://yuseinishiyama.com/archives.html">Archives</a></div>
  <div class="view"><a href="http://yuseinishiyama.com/categories">Categories</a></div>
</p>

<!-- Social links -->
<div class="social">
<h4>Follow Me</h4>
<ul>
    <li><a href="https://twitter.com/yuseinishiyama">twitter</a></li>
    <li><a href="https://github.com/yuseinishiyama">github</a></li>
</ul>
</div>

      </header>
      <section>
<section id="content" class="body">
  <article>
      <div class="article-title">
        『12ステップで作る組込みOS自作入門』を読んで〜モバイルアプリエンジニアの生存戦略〜
      </div>

    <div class="entry-content">
<p>
<small>
<abbr class="published" title="2014-09-22T01:37:00">
  2014-09-22(月)
</abbr> | 
 -- (<a href="http://yuseinishiyama.com/posts/2014/09/22/embedded-os-in-12steps/" rel="bookmark">permalink</a>)
</small>
</p>      <iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=usay0b-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=4877832394" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

<p>『12ステップで作る組込みOS自作入門』という本を読んだので、その内容や感想について書いてみる。</p>
<h1>動機</h1>
<h3>ウェアラブル時代に備えて</h3>
<p>勝手な予想ではあるが、これからウェアラブル端末向けアプリケーションの需要が高まるとすれば、それはすなわち計算資源の少ない環境での開発が避けられないということではないかと思う。そうすると、アプリケーション開発者も低レイヤの知識を身につけておいて損はないのではないかと考えている。</p>
<h3>モバイルソフトウェアの限界を感じて</h3>
<p>なんとなくソフトウェアだけで問題が解決できそうな時代ではなくなってきた気がして不安を感じている。もし本当にハードウェア・スタートアップとかが台頭してきて、一山当てる時代とかになったら対応できないとまずそうだ。(モバイルソフトウェア開発自体に価値がないということではない。「アプリとか誰でも作れる。そのうち無くなる仕事。」みたいなニュアンスの語り口の人をtwitterとかで稀に見ることがあるが、「いや、そもそもこっちだって動くものを作るだけなら簡単なのは百も承知だ」というのがあって、そういう言説には多少イライラしている。ある程度の規模のアプリケーションを長期的に運用していくマネジメントとか、大規模なフレームワークを隅まで理解している人の重要さとかを側で見ていると、「誰でも作れる、なんていう暴論を吐くのはアプリケーション開発に対する無知のなせる業だろ」っていうのが一番言いたくなることだが、それは置いておく。)</p>
<h3>未来予測のため</h3>
<p>コンパイラやハードの進化がソフトウェアで実現できることを底上げするわけであるから、これらの進化を追うことはソフトウェアの未来予測に繋がるはずである。例えば、Appleが製造するチップの性能やLLVMの新機能などを見ていれば、Apple製デバイスの長期的な戦略が多少は察しがつく(今だとGPU関連の技術への投資が目立つ...)。</p>
<h3>ブラックボックスを減らすことで、心理的負荷が下がる</h3>
<p>私の中でプログラミングの最大のモチベーションはブラックボックスを減らすことだ。前書きにこんな記述がある。</p>
<blockquote>
<p>興味があれば、本を読むのも試行錯誤をするのも面白いでしょう。面白ければ続けることができます。大切なのは継続することです。そしてそのために考えるべきは、「どの順番で読むべきか？」ではなく「自分のモチベーションを維持するにはどうしたらよいか？」なのです。だから好きなことをやる、興味のあることを優先するという考えは、とても良いと思います。</p>
</blockquote>
<p>どんなレベルであれプロであるのだから、自分が生み出すものの価値を考えないといけないのは当たり前だが、その生産者である自分のモチベーションがゼロになったら何も届けられない。だから、自分のモチベーションを維持することを最優先に置くことに罪悪感を感じる必要はないのだろう。「まえがき」、「あとがき」が熱い本は大体良書である。</p>
<h1>なぜこの本か</h1>
<p>以下の条件で絞った。</p>
<ul>
<li>OSの理論的説明だけではなく、実装レベルで知りたい</li>
<li>1,2ヶ月ぐらいで終わりそう</li>
</ul>
<p>すると、この本と『30日でできる！OS自作入門』ぐらいしか残らなかった。汎用OS向けのアプリケーションの開発者である以上、後者をやるほうが自然な気もしたが、後者を軽く立ち読みしたところ相当な章をGUIの実装に割いており、基本的な部分が知りたい自分には合わないと思ったので、結局この『12ステップで作る組込みOS自作入門』を選んだ。Linuxカーネルのソースとか読めたらいいのだが、自分を過信しても仕方がない。</p>
<p>特に良かったところは</p>
<h3>無駄が少ない。最小構成。</h3>
<p>派手な機能は一切なく、OSと呼べるものの最小のものを作る。本当に知りたいことだけを知れる。できることが少ない代わりに、見事なほどブラックボックスが排除されている。</p>
<h3>GNUのツール群を採用</h3>
<p>この書籍内でしか使えない知識ではなく、普遍的な知識が身につく。</p>
<h3>Mac OSXの環境でも開発できる</h3>
<p>http://blog.livedoor.jp/noanoa07/archives/1991674.html</p>
<p>とか</p>
<p>http://www.slideshare.net/sandai/12step-1-14296356</p>
<p>が役に立った。</p>
<h1>学べること</h1>
<h3>アセンブラ</h3>
<p>スタート・アップ部や割込み処理でのレジスタ退避などの箇所でアセンブラを書く必要があった。主にスタックポインタやプログラムカウンタの操作。特に「どういう部分はC言語ではなくアセンブラで書く必要があるのか」ということが理解できたのが良かった。</p>
<h3>リンカ・スクリプト</h3>
<p>はじめてリンカスクリプトを書いた。実際にメモリマップを指定して、テキスト領域、データ領域、BSS領域などを設定することで、実行時にメモリがどうなっているのか具体的にイメージできるようになった。</p>
<h3>標準ライブラリ関数</h3>
<p>コンソールの入出力やメモリ管理用の関数を自分で作成した。</p>
<h3>スタート・アップ</h3>
<p>main関数を実行する部分を実装することで、自分が作成したプログラムがどのように実行されるのかイメージできるようになった。今まではmain関数から先のことしか理解していなかったので、見通しが良くなった。</p>
<h3>ローダ及びオブジェクト・ファイル・フォーマット</h3>
<p>ELF形式を解析しメモリ上に展開するローダを作成した。</p>
<h1>学べないこと</h1>
<p>汎用OSの本ではないので、仮想メモリやプロセスについては学べない。また、多重割込みも実装しない。</p>
<h1>どういう人が読むべきか</h1>
<p>自分と同じような境遇の人は読むと相当な見返りがあると思われる。つまり、専門教育などによってハードウェアに関する教養を身につけたことがなく、ソフトウェアの開発しかしたことが無いような人には確実にお勧めできる。まっとうな経緯でプログラマになり、そんなことは働く前に知ることでしょ、というような人はもちろん読む必要がないと思う。</p>
<h1>ハードウェアとソフトウェアのインターフェース</h1>
<p>コンピュータに関する包括的な知識が記述されている本ではじめて読んだのは『文系学生のためのコンピュータ概論』という本だった。</p>
<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=usay0b-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=432012278X" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

<p>これは、新卒で入った会社の研修の一環で読まされたのだが、なかなか良い本だった。「バベッジがあれした」とか「エニグマ暗号がどうだったとか」いう話から、OS、コンピュータの五大要素といったお約束の話が載っていて、今思うと大した内容ではないのだが、これを読んでなければジャババーチャルマシンの上で「Hello, World」やっているレイヤから一切出ようと思わなかったかもしれない。</p>
<p>その後、もう少し利口になったところでパタヘネを読んだのだが、こっちは少し難しくて通読するというわけにはいかなかった。リファレンス的に使う分にはかなり役に立っているが。</p>
<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=usay0b-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=482228266X" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

<p>ところで、このパタヘネのサブタイトルは『ハードウェアとソフトウェアのインターフェース』というものだが、この『組込みOS自作入門』もハードとソフトの狭間を見せてくれるという意味で、パタヘネの導入として良い本ではないかと思う。メモリマップドI/Oでのレジスタ・マッピング、割り込みベクタのアドレス、汎用レジスタの仕様などといったハードウェアの詳細を考えてプログラムを書くことで、まさに『ハードウェアのソフトウェアのインターフェース』を体感できる。</p>
<h1>難易度</h1>
<p>相当に親切な本だと感じた。特に前半はスラスラと読むことができた。ただ、Amazonのレビューとかを見る感じだと、後半は結構難しいみたいなことが書いてあって、実際少し難しかった。アセンブラやリンカ・スクリプト内のシンボルを参照したり、割込みでプログラム・カウンタが強制的に書き換わったりするというようなことを普段の開発では考えることがないので、後半に行くにつれてコードを追うのが難しくなっていく。とはいえ、挫折するレベルではないし、このレベルの知識をこの易しさで説明できている本は他にないと思われる。スレッドを実装する8thステップが全体の中で大きな比重を占めるので、ここを熟読するのが良いと思われる。</p>
    </div><!-- /.entry-content -->
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'yuseinishiyama'; // required: replace example with your forum shortname
        var disqus_identifier = "posts/2014/09/22/embedded-os-in-12steps/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>
</section>
      </section>
      <footer>
        <p><small>&copy; だからといって、このままでいいはずがない。 &mdash; Theme based on Sundown by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!-- Scale fix -->
    <script>
      var metas = document.getElementsByTagName('meta');
      var i;
      
      if (navigator.userAgent.match(/iPhone/i)) {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
          }
        }
      
        document.addEventListener("gesturestart", gestureStart, false);
      }

      function gestureStart() {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
          }
        }
      }
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48020408-1', 'yuseinishiyama.com');
  ga('send', 'pageview');
</script>
  </body>
</html>